# Overview

This repo hosts a collection of scripts for ACI as Code
(<https://netascode.cisco.com>). These scripts are designed for a single
multi-fabric repo, where fabric configurations are under `./fabrics/<fabric>`;
however, they could be adapted for other file layouts.

The scripts all take a single CLI parameter specifying the name of the fabric
(the name of the path under `./fabrics/`). Scripts are typically stored in a
`./scripts/` folder and executed from the repo root.

# Scripts

## `gen_imports.py`

Generates `import.tf` from the Terraform plan. This script generates Terraform
import blocks to import objects instead of creating them new. It is intended for
a brownfield ACI migration to avoid production impact.

In order to run this, we must have a `plan.json` generated by
`terraform show plan.tfplan -json > plan.json`. To generate a `plan.tfplan`, run
`terraform plan -out plan.tfplan`.

## `render_aci_fabrics.py`

Render Jinja2 templates for ACI fabric configurations. This script is designed
for templating common configurations that exist across multiple fabrics. For
example, if all fabrics have NTP configured, but each has different NTP servers,
a template could be created with only the NTP configuration in it, with Jinja
variable tags in place of the actual server IPs. The IPs would be defined in
each fabric's `vars.yaml` file.

This renders any templates in the `./templates` folder using the context from
`./fabrics/<fabric>/vars.yaml` and outputs the rendered files to
`./fabrics/<fabric>/data/<template_name>.rendered.nac.yaml`.

**Note** that `vars.yaml` and the `templates` folder are defined with global
variables at the top of the script, and can be easily customized to fit your
repo structure.

## `review.py`

Review parses the `plan.json` and provides a concise summary of changes. This
differs from the standard terraform plan and show as it clearly shows imports,
creates, and changes in a more concise, human-readable format. In order to run
this script, a `plan.json` must exist from the previous `terraform plan` and
`terraform show` commands. If using as part of a brownfield import, these
commands must be run _after_ running `gen_imports.py` to ensure the plan
reflects the imported objects.
